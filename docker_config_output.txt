name: cps714-section6
services:
  migrate:
    container_name: cps714_migrator
    depends_on:
      postgres:
        condition: service_healthy
        required: true
    entrypoint:
      - /bin/sh
      - -c
      - migrate -path=/migrations -database=postgresql://root:admin@postgres:5432/campus_connect_db?sslmode=disable up
    image: migrate/migrate:latest
    networks:
      default: null
    volumes:
      - type: bind
        source: C:\Users\hamza\Desktop\CPS714-Section6\migrations
        target: /migrations
        bind:
          create_host_path: true
  postgres:
    container_name: cps714_postgres
    environment:
      POSTGRES_DB: campus_connect_db
      POSTGRES_PASSWORD: admin
      POSTGRES_USER: root
      TZ: UTC
    healthcheck:
      test:
        - CMD-SHELL
        - pg_isready -U root -d campus_connect_db
      timeout: 10s
      interval: 5s
      retries: 5
      start_period: 30s
    image: postgres:16
    networks:
      default: null
    ports:
      - mode: ingress
        target: 5432
        published: "5432"
        protocol: tcp
    restart: always
    volumes:
      - type: bind
        source: C:\Users\hamza\Desktop\CPS714-Section6\.postgres
        target: /var/lib/postgresql/data
        bind:
          create_host_path: true
networks:
  default:
    name: cps714-section6_default
